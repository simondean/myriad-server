#!/usr/bin/env node

'use strict';

var Optimist = require('optimist');
var Myriad = require('../lib/myriad-server');

function exit(code) {
  process.stdout.once('drain', function () { process.exit(code); });
  process.stdout.write('');
};

var optimist = Optimist
  .usage('Usage: $0 [options] bin [args]')
  .options('h', {
    alias: 'help',
    describe: 'Displays this help message'
  });
var argv = optimist.argv;

if (argv.help) {
  optimist.showHelp();
  exit(0);
}
else {
  Myriad(argv).run(function(err) {
    if (err) {
      console.error(err);
      exit(1);
    }
    else {
      exit(0);
    }
  })
}
